#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

#env variables
JAVA_DIST="openjdk1.7.0_21"
JDK7_URL="https://s3.amazonaws.com/heroku-jdk/${JAVA_DIST}.tar.gz"

#jdk7
if [ -d .jdk7 ]; then
  echo "-----> .jdk7 folder found, moving along."
else
  echo "-----> .jdk7 folder not found!"
  echo -n "-----> Installing ${JAVA_DIST} build (to .jdk7)....."
  mkdir ".jdk7"
  cd ".jdk7"
  curl --max-time 180 --location "$JDK7_URL" | tar xz
  cd ..
  echo "Done!"
fi

export JAVA_HOME=".jdk7"
export PATH="$JAVA_HOME/bin:$PATH"

echo ""
echo "-----> Building project with Gradle wrapper:"
echo "       ./gradlew clean installApp"
export GRADLE_OPTS="-Dfile.encoding=UTF-8 -server -Xmx512m -XX:+UseCompressedOops"
export GRADLE_USER_HOME="$CACHE_DIR/.gradle"

./gradlew clean installApp
